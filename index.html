<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bud≈ºet Domowy - Zaawansowany Planer Finansowy</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #e91e63;
            --secondary-color: #ad1457;
            --accent-color: #f8bbd9;
            --light-bg: #fce4ec;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --info-color: #2196f3;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #fff;
            --border: #e0e0e0;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="blue"] {
            --primary-color: #2196f3;
            --secondary-color: #1565c0;
            --accent-color: #bbdefb;
            --light-bg: #e3f2fd;
        }

        [data-theme="green"] {
            --primary-color: #4caf50;
            --secondary-color: #2e7d32;
            --accent-color: #c8e6c9;
            --light-bg: #e8f5e8;
        }

        [data-theme="purple"] {
            --primary-color: #9c27b0;
            --secondary-color: #6a1b9a;
            --accent-color: #e1bee7;
            --light-bg: #f3e5f5;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--accent-color) 100%);
            min-height: 100vh;
            padding: 10px;
            overflow-x: auto;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            color: #fff;
        }

        body.dark-mode .container {
            background: #333;
            color: #fff;
        }

        body.dark-mode .section, 
        body.dark-mode .card {
            background: #444;
            border-color: #555;
        }

        body.dark-mode .table th {
            background: #555;
        }

        body.dark-mode .input-group input, 
        body.dark-mode .input-group select {
            background: #555;
            color: #fff;
            border-color: #666;
        }

        body.dark-mode .ai-insights {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }

        body.dark-mode .insight-item {
            background: rgba(255,255,255,0.15);
        }

        body.dark-mode .debt-card,
        body.dark-mode .goal-card {
            background: #444;
            border-color: #555;
        }

/* Calendar Styles */
        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 10px;
        }

        .calendar-title {
            font-size: 1.3em;
            color: var(--secondary-color);
            margin: 0;
            text-transform: capitalize;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.1);
            border: 2px solid var(--accent-color);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            max-width: 100%;
        }

        .calendar-day {
            min-height: 80px;
            border: 1px solid var(--accent-color);
            padding: 8px;
            position: relative;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .calendar-day:hover {
            background: var(--light-bg);
            transform: scale(1.02);
        }

        .calendar-day.header {
            background: var(--primary-color);
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 12px 8px;
            min-height: auto;
            cursor: default;
        }

        .calendar-day.header:hover {
            transform: none;
            background: var(--primary-color);
        }

        .calendar-day.other-month {
            background: #f8f8f8;
            color: #999;
        }

        .calendar-day.today {
            background: linear-gradient(135deg, var(--info-color), #1565c0);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-payment {
            background: linear-gradient(135deg, var(--light-bg), white);
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(233, 30, 99, 0.2);
        }

        .calendar-day-number {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .payment-list {
            font-size: 10px;
            line-height: 1.2;
        }

        .payment-item {
            background: var(--primary-color);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .payment-item.recurring {
            background: var(--info-color);
        }

        .payment-more {
            background: var(--warning-color);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 9px;
            text-align: center;
        }

        body.dark-mode .calendar-day {
            background: #444;
            border-color: #555;
            color: #fff;
        }

        body.dark-mode .calendar-day.other-month {
            background: #333;
            color: #888;
        }

        body.dark-mode .calendar-day.has-payment {
            background: #555;
            border-color: var(--primary-color);
        }

        body.dark-mode .calendar-container {
            background: #444;
        }
/* RODO Styles */
        .rodo-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
            z-index: 10000;
            transform: translateY(100%);
            transition: transform 0.5s ease;
        }

        .rodo-banner.show {
            transform: translateY(0);
        }

        .rodo-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .rodo-content h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .rodo-content p {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .rodo-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .rodo-buttons .btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            font-weight: bold;
        }

        .rodo-buttons .btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .rodo-details {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10001;
            display: none;
            overflow-y: auto;
            padding: 20px;
        }

        .rodo-details.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rodo-details-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .rodo-details-content h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .rodo-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 10px;
        }

        .rodo-section h4 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .rodo-section ul {
            margin-left: 20px;
        }

        .rodo-section li {
            margin-bottom: 5px;
            line-height: 1.4;
        }

        body.dark-mode .rodo-details-content {
            background: #333;
            color: #fff;
        }

        body.dark-mode .rodo-section {
            background: #444;
        }

        @media (max-width: 768px) {
            .rodo-banner {
                padding: 15px;
            }

            .rodo-content h3 {
                font-size: 1.1em;
            }

            .rodo-content p {
                font-size: 0.9em;
            }

            .rodo-buttons {
                flex-direction: column;
            }

            .rodo-details {
                padding: 10px;
            }

            .rodo-details-content {
                padding: 20px;
            }
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(233, 30, 99, 0.1);
            overflow: visible;
            min-height: auto;
            padding-bottom: 30px;
            transition: all 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
        }

        .header-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            align-items: center;
        }

        .theme-selector {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .theme-btn {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .theme-btn:hover, .theme-btn.active {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .theme-pink { background: #e91e63; }
        .theme-blue { background: #2196f3; }
        .theme-green { background: #4caf50; }
        .theme-purple { background: #9c27b0; }

        .header-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.25);
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: var(--light-bg);
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.1);
            border: 2px solid var(--accent-color);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .card h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 1em;
        }

        .card .amount {
            font-size: 1.6em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .card .trend {
            font-size: 0.8em;
            margin-top: 5px;
            opacity: 0.7;
        }

        .ai-insights {
            background: linear-gradient(135deg, var(--info-color) 0%, #1565c0 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .ai-insights h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .nav-tabs {
            display: flex;
            background: var(--light-bg);
            border-bottom: 2px solid var(--accent-color);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-dark);
            transition: all 0.3s ease;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: rgba(233, 30, 99, 0.1);
        }

        .nav-tab.active {
            background: white;
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .main-content {
            padding: 20px;
        }

        .section {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.1);
            border: 2px solid var(--accent-color);
        }

        .section h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .input-group {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-group label {
            flex: 1;
            font-weight: 500;
            color: var(--text-light);
            min-width: 120px;
        }

        .input-group input, .input-group select {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .btn-success { background: linear-gradient(135deg, var(--success-color), #2e7d32); }
        .btn-warning { background: linear-gradient(135deg, var(--warning-color), #f57c00); }
        .btn-danger { background: linear-gradient(135deg, var(--error-color), #c62828); }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--accent-color);
        }

        .table th {
            background: var(--light-bg);
            color: var(--secondary-color);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .table td button {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
        }

        .progress-bar {
            background: #f5f5f5;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
            position: relative;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            position: relative;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }

        .goal-card, .debt-card {
            background: linear-gradient(135deg, #fff 0%, var(--light-bg) 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid var(--accent-color);
            transition: transform 0.3s ease;
        }

        .goal-card:hover, .debt-card:hover {
            transform: translateY(-3px);
        }

        .goal-header, .debt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .goal-title, .debt-title {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .goal-amount {
            font-size: 1.1em;
            color: var(--primary-color);
            font-weight: bold;
        }

        .debt-amount {
            font-size: 1.1em;
            color: var(--error-color);
            font-weight: bold;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--error-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .positive { color: var(--success-color); }
        .negative { color: var(--error-color); }

        .debug-panel {
            background: #fffacd;
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .debug-info {
            font-size: 0.9em;
            color: #8b4513;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .two-column, .three-column {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: repeat(2, 1fr);
                padding: 15px;
            }

            .input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .input-group label {
                min-width: auto;
            }

            body {
                padding: 5px;
            }

            .container {
                border-radius: 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
            }

            .nav-tabs {
                overflow-x: auto;
            }

            .nav-tab {
                padding: 12px 20px;
            }
            .calendar-day {
                min-height: 60px;
                padding: 4px;
            }

            .calendar-navigation {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .calendar-title {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body data-theme="pink">
    <div class="notification" id="notification"></div>
<!-- RODO Banner -->
    <div id="rodoBanner" class="rodo-banner">
        <div class="rodo-content">
            <h3>üîí Informacja o danych osobowych</h3>
<button class="btn" onclick="acceptRodo()">‚úÖ Akceptujƒô</button>
<button class="btn btn-warning" onclick="showRodoDetails()">üìÑ Szczeg√≥≈Çy</button>
<button class="btn btn-danger" onclick="rejectRodo()">‚ùå Odrzucam</button>
            </div>
        </div>
    </div>

    <!-- Szczeg√≥≈Çy RODO -->
    <div id="rodoDetails" class="rodo-details">
        <div class="rodo-details-content">
            <h3> Szczeg√≥≈Çy przetwarzania danych</h3>
            <div class="rodo-section">
                <h4> Jakie dane przechowujemy:</h4>
                <ul>
                    <li>Twoje dochody, wydatki, cele finansowe</li>
                    <li>Ustawienia aplikacji (motyw, waluta)</li>
                    <li>Daty ostatnich aktualizacji</li>
                </ul>
            </div>
            <div class="rodo-section">
                <h4> Gdzie przechowujemy dane:</h4>
                <ul>
                    <li><strong>localStorage</strong> - lokalnie w Twojej przeglƒÖdarce</li>
                    <li>≈ªadne dane nie sƒÖ wysy≈Çane na nasze serwery</li>
                    <li>Dane pozostajƒÖ tylko na Twoim urzƒÖdzeniu</li>
                </ul>
            </div>
            <div class="rodo-section">
                <h4> Po≈ÇƒÖczenia zewnƒôtrzne:</h4>
                <ul>
                    <li><strong>exchangerate-api.com</strong> - pobieranie kurs√≥w walut (bez danych osobowych)</li>
                    <li>Brak tracker√≥w analitycznych</li>
                    <li>Brak reklam</li>
                </ul>
            </div>
            <div class="rodo-section">
                <h4> Twoje prawa:</h4>
                <ul>
                    <li>Mo≈ºesz w ka≈ºdej chwili usunƒÖƒá wszystkie dane</li>
                    <li>Mo≈ºesz wyeksportowaƒá swoje dane</li>
                    <li>Mo≈ºesz przestaƒá korzystaƒá z aplikacji</li>
                </ul>
            </div>
            <div class="rodo-buttons">
                <button class="btn" onclick="acceptRodo()"> Akceptujƒô</button>
                <button class="btn btn-danger" onclick="closeRodoDetails()"> Zamknij</button>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="header">
            <h1>üí∞ Bud≈ºet Domowy</h1>
            <p>Zaawansowany planer finansowy z pe≈ÇnƒÖ analizƒÖ</p>
            <div class="header-controls">
                <div class="theme-selector">
                    <span style="margin-right: 10px;">üé® Motyw:</span>
                    <div class="theme-btn theme-pink active" onclick="changeTheme('pink')"></div>
                    <div class="theme-btn theme-blue" onclick="changeTheme('blue')"></div>
                    <div class="theme-btn theme-green" onclick="changeTheme('green')"></div>
                    <div class="theme-btn theme-purple" onclick="changeTheme('purple')"></div>
                </div>
                <button class="header-btn" onclick="toggleDarkMode()">üåô Tryb ciemny</button>
                <button class="header-btn" onclick="exportData()">üíæ Zapisz</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData()">
                <button class="header-btn" onclick="document.getElementById('importFile').click()">üìÇ Wczytaj</button>
                <button class="header-btn" onclick="clearAllData()">üóëÔ∏è Wyczy≈õƒá</button>
            </div>
        </div>

        <div class="summary-cards">
            <div class="card">
                <h3>üí∞ ≈ÅƒÖczny Doch√≥d</h3>
                <div class="amount" id="totalIncome">0,00 z≈Ç</div>
                <div class="trend" id="incomeTrend">Bez zmian</div>
            </div>
            <div class="card">
                <h3>üí∏ ≈ÅƒÖczne Wydatki</h3>
                <div class="amount" id="totalExpenses">0,00 z≈Ç</div>
                <div class="trend" id="expensesTrend">Bez zmian</div>
            </div>
            <div class="card">
                <h3>üê∑ Oszczƒôdno≈õci</h3>
                <div class="amount" id="totalSavings">0,00 z≈Ç</div>
                <div class="trend" id="savingsTrend">Bez zmian</div>
            </div>
            <div class="card">
                <h3>üí≥ D≈Çugi do sp≈Çaty</h3>
                <div class="amount" id="totalDebts">0,00 z≈Ç</div>
                <div class="trend" id="debtsTrend">Bez zmian</div>
            </div>
            <div class="card">
                <h3>üìä Saldo</h3>
                <div class="amount" id="balance">0,00 z≈Ç</div>
                <div class="trend" id="balanceTrend">Bez zmian</div>
            </div>
            <div class="card">
                <h3>üíµ Do Dyspozycji</h3>
                <div class="amount" id="available">0,00 z≈Ç</div>
                <div class="trend" id="availableTrend">Bez zmian</div>
            </div>
        </div>

        <div class="ai-insights" id="aiInsights">
            <h3><span>ü§ñ</span> Inteligentne Analizy AI</h3>
            <div id="aiInsightsList">
                <div class="insight-item">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.3em;">üí°</span>
                        <div>
                            <strong>Witaj w aplikacji bud≈ºetu domowego!</strong> 
                            <span>Rozpocznij dodawanie swoich dochod√≥w i wydatk√≥w, aby otrzymaƒá spersonalizowane analizy finansowe.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="budget">üí∞ Bud≈ºet</button>
            <button class="nav-tab" data-tab="goals">üéØ Cele</button>
            <button class="nav-tab" data-tab="calendar">üìÖ Kalendarz</button>
            <button class="nav-tab" data-tab="analytics">üìä Analizy</button>
            <button class="nav-tab" data-tab="reports">üìã Raporty</button>
            <button class="nav-tab" data-tab="debts">üí≥ D≈Çugi</button>
            <button class="nav-tab" data-tab="settings">‚öôÔ∏è Ustawienia</button>
        </nav>

        <div class="main-content">
            <!-- Budget Tab -->
            <div id="budget" class="tab-content active">
                <div class="two-column">
                    <div class="section">
                        <h2>üè† Dochody</h2>
                        <div class="input-group">
                            <label>≈πr√≥d≈Ço:</label>
                            <input type="text" id="incomeSource" placeholder="np. Pensja, Freelance">
                        </div>
                        <div class="input-group">
                            <label>Kategoria:</label>
                            <select id="incomeCategory">
                                <option value="salary">üíº Pensja</option>
                                <option value="freelance">üíª Freelance</option>
                                <option value="business">üè¢ Biznes</option>
                                <option value="investment">üìà Inwestycje</option>
                                <option value="other">üîÑ Inne</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Kwota:</label>
                            <input type="number" id="incomeAmount" placeholder="0.00" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Waluta:</label>
                            <select id="incomeCurrency">
                                <option value="PLN">PLN</option>
                                <option value="EUR">EUR</option>
                                <option value="USD">USD</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="addIncome()">Dodaj Doch√≥d</button>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>≈πr√≥d≈Ço</th>
                                    <th>Kategoria</th>
                                    <th>Kwota</th>
                                    <th>Waluta</th>
                                    <th>Akcja</th>
                                </tr>
                            </thead>
                            <tbody id="incomeList"></tbody>
                        </table>
                    </div>

                    <div class="section">
                        <h2>üí∏ Wydatki</h2>
                        <div class="input-group">
                            <label>Nazwa:</label>
                            <input type="text" id="expenseName" placeholder="np. Czynsz, Zakupy">
                        </div>
                        <div class="input-group">
                            <label>Kategoria:</label>
                            <select id="expenseCategory">
                                <option value="housing">üè† Mieszkanie</option>
                                <option value="food">üçΩÔ∏è Jedzenie</option>
                                <option value="transport">üöó Transport</option>
                                <option value="health">‚öïÔ∏è Zdrowie</option>
                                <option value="entertainment">üé¨ Rozrywka</option>
                                <option value="shopping">üõçÔ∏è Zakupy</option>
                                <option value="education">üìö Edukacja</option>
                                <option value="utilities">‚ö° Media</option>
                                <option value="other">üîÑ Inne</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Kwota:</label>
                            <input type="number" id="expenseAmount" placeholder="0.00" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Waluta:</label>
                            <select id="expenseCurrency">
                                <option value="PLN">PLN</option>
                                <option value="EUR">EUR</option>
                                <option value="USD">USD</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="addExpense()">Dodaj Wydatek</button>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nazwa</th>
                                    <th>Kategoria</th>
                                    <th>Kwota</th>
                                    <th>Waluta</th>
                                    <th>Akcja</th>
                                </tr>
                            </thead>
                            <tbody id="expenseList"></tbody>
                        </table>
                    </div>
                </div>

                <div class="section">
                    <h2>üê∑ Plan Oszczƒôdno≈õci</h2>
                    <div class="three-column">
                        <div class="input-group">
                            <label>Cel:</label>
                            <input type="text" id="savingGoal" placeholder="np. Wakacje, Samoch√≥d">
                        </div>
                        <div class="input-group">
                            <label>Kwota miesiƒôczna:</label>
                            <input type="number" id="savingAmount" placeholder="0.00" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Priorytet:</label>
                            <select id="savingPriority">
                                <option value="high">üî¥ Wysoki</option>
                                <option value="medium">üü° ≈öredni</option>
                                <option value="low">üü¢ Niski</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>&nbsp;</label>
                        <button class="btn" onclick="addSaving()">Dodaj Plan</button>
                    </div>
                    <div id="savingsList"></div>
                </div>
            </div>

            <!-- Goals Tab -->
            <div id="goals" class="tab-content">
                <div class="section">
                    <h2>üéØ Cele Finansowe</h2>
                    <div class="three-column">
                        <div class="input-group">
                            <label>Nazwa celu:</label>
                            <input type="text" id="goalName" placeholder="np. Wakacje, Dom">
                        </div>
                        <div class="input-group">
                            <label>Docelowa kwota:</label>
                            <input type="number" id="goalTarget" placeholder="0.00" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Termin:</label>
                            <input type="date" id="goalDeadline">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>&nbsp;</label>
                        <button class="btn" onclick="addGoal()">Dodaj Cel</button>
                    </div>
                    <div id="goalsList"></div>
                </div>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-content">
                <div class="section">
                    <h2>üìÖ Kalendarz P≈Çatno≈õci</h2>
                    <div class="three-column">
                        <div class="input-group">
                            <label>Nazwa:</label>
                            <input type="text" id="paymentName" placeholder="np. Czynsz, Rachunki">
                        </div>
                        <div class="input-group">
                            <label>Data:</label>
                            <input type="date" id="paymentDate">
                        </div>
                        <div class="input-group">
                            <label>Kwota:</label>
                            <input type="number" id="paymentAmount" placeholder="0.00" step="0.01">
                        </div>
                    </div>
                    <div class="two-column">
                        <div class="input-group">
                            <label>Cykliczno≈õƒá:</label>
                            <select id="paymentRecurring">
                                <option value="none">Jednorazowa</option>
                                <option value="weekly">Co tydzie≈Ñ</option>
                                <option value="monthly">Co miesiƒÖc</option>
                                <option value="yearly">Co rok</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>&nbsp;</label>
                            <button class="btn" onclick="addPayment()">Dodaj P≈Çatno≈õƒá</button>
                        </div>
                    </div>

                    <!-- Calendar Navigation -->
                    <div class="calendar-navigation">
                        <button class="btn btn-small" onclick="changeMonth(-1)">‚¨ÖÔ∏è Poprzedni</button>
                        <h3 class="calendar-title" id="currentMonthYear"></h3>
                        <button class="btn btn-small" onclick="changeMonth(1)">Nastƒôpny ‚û°Ô∏è</button>
                    </div>

                    <div class="calendar-container">
                        <div class="calendar" id="calendarGrid"></div>
                    </div>

                    <!-- Payment List -->
                    <div style="margin-top: 30px;">
                        <h3>üìã Lista P≈Çatno≈õci</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nazwa</th>
                                    <th>Data</th>
                                    <th>Kwota</th>
                                    <th>Cykliczno≈õƒá</th>
                                    <th>Akcja</th>
                                </tr>
                            </thead>
                            <tbody id="paymentList"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="two-column">
                    <div class="chart-container">
                        <h3>üìä Rozk≈Çad Wydatk√≥w wed≈Çug Kategorii</h3>
                        <div class="chart-wrapper">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>üìà Trend Miesiƒôczny (6 miesiƒôcy)</h3>
                        <div class="chart-wrapper">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>üí∞ Por√≥wnanie Dochod√≥w i Wydatk√≥w</h3>
                    <div class="chart-wrapper">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
                <div class="two-column">
                    <div class="chart-container">
                        <h3>üéØ Postƒôp Cel√≥w Finansowych</h3>
                        <div class="chart-wrapper">
                            <canvas id="goalsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3>üí≥ Struktura D≈Çug√≥w</h3>
                        <div class="chart-wrapper">
                            <canvas id="debtsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <div class="section">
                    <h2>üìã Raporty Finansowe</h2>
                    <div class="three-column">
                        <button class="btn" onclick="generateReport('monthly')">Raport Miesiƒôczny</button>
                        <button class="btn" onclick="generateReport('yearly')">Raport Roczny</button>
                        <button class="btn" onclick="generateReport('category')">Raport Kategorii</button>
                    </div>
                    <div id="reportContent"></div>
                </div>
            </div>

            <!-- Debts Tab -->
            <div id="debts" class="tab-content">
                <div class="section">
                    <h2>üí≥ ZarzƒÖdzanie D≈Çugami</h2>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="input-group">
                            <label>Nazwa d≈Çugu:</label>
                            <input type="text" id="debtName" placeholder="np. Kredyt hipoteczny">
                        </div>
                        <div class="input-group">
                            <label>Kwota d≈Çugu:</label>
                            <input type="number" id="debtAmount" placeholder="100000.00" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Rata miesiƒôczna:</label>
                            <input type="number" id="debtInstallment" placeholder="2500.00" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>Oprocentowanie (%):</label>
                            <input type="number" id="debtInterest" placeholder="5.5" step="0.01">
                        </div>
                    </div>

                    <div class="input-group" style="justify-content: center; margin: 20px 0;">
                        <button class="btn" onclick="addDebt()" style="padding: 12px 30px; font-size: 16px;">
                            ‚ûï DODAJ D≈ÅUG
                        </button>
                    </div>

                    <div style="margin: 20px 0;">
                        <h3>üí° Strategia Sp≈Çaty D≈Çug√≥w</h3>
                        <div class="two-column">
                            <button class="btn btn-warning" onclick="sortDebtsByInterest();">
                                üìà Sortuj wg oprocentowania
                            </button>
                            <button class="btn btn-success" onclick="sortDebtsByAmount();">
                                üí∞ Sortuj wg kwoty
                            </button>
                        </div>
                    </div>

                    <div id="debtsList">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <h3>üìù Brak d≈Çug√≥w</h3>
                            <p>Dodaj sw√≥j pierwszy d≈Çug u≈ºywajƒÖc formularza powy≈ºej</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="section">
                    <h2>‚öôÔ∏è Ustawienia</h2>
                    <div class="two-column">
                        <div>
                            <h3>üí± Kalkulator Walut</h3>
                            <div class="input-group">
<div class="input-group">
                                <button class="btn" onclick="fetchExchangeRates()" style="background: var(--info-color);">  Od≈õwie≈º kursy walut
                                </button>
                                <small id="lastUpdateInfo" style="color: #666; margin-left: 10px;">
                                    Kursy z: nie pobrano jeszcze
                                </small>
                            </div>
                                <label>Kwota:</label>
                                <input type="number" id="convertAmount" placeholder="0.00" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Z:</label>
                                <select id="fromCurrency">
                                    <option value="PLN">PLN</option>
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                    <option value="GBP">GBP</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Na:</label>
                                <select id="toCurrency">
                                    <option value="EUR">EUR</option>
                                    <option value="PLN">PLN</option>
                                    <option value="USD">USD</option>
                                    <option value="GBP">GBP</option>
                                </select>
                            </div>
                            <button class="btn" onclick="convertCurrency()">Przelicz</button>
                            <div id="conversionResult" style="margin-top: 15px; padding: 15px; background: var(--light-bg); border-radius: 8px; display: none;"></div>
                        </div>
                        <div>
                            <h3>üîß Preferencje</h3>
                            <div class="input-group">
                                <label>Domy≈õlna waluta:</label>
                                <select id="defaultCurrency" onchange="updateDefaultCurrency()">
                                    <option value="PLN">PLN</option>
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                    <option value="GBP">GBP</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Automatyczne kopie zapasowe:</label>
                                <input type="checkbox" id="autoBackup" onchange="toggleAutoBackup()">
                            </div>
                            <div class="input-group">
                                <label>Powiadomienia:</label>
                                <input type="checkbox" id="notifications" onchange="toggleNotifications()" checked>
                            </div>
<div id="rodoSettingsSection" style="margin-top: 20px;">
                                <!-- Sekcja RODO bƒôdzie wstawiona przez JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Inicjalizacja aplikacji bud≈ºetu domowego...');

        // Globalne dane aplikacji
        let data = {
            incomes: [],
            expenses: [],
            savings: [],
            goals: [],
            payments: [],
            debts: [],
            settings: {
                defaultCurrency: 'PLN',
                autoBackup: false,
                notifications: true,
                theme: 'pink',
                darkMode: false,
                autoRateUpdate: false,
                lastRateUpdate: null
            }
        };

        // Aktualna data kalendarza
        let currentCalendarDate = new Date();

// Dynamiczne kursy walut
let exchangeRates = {
    PLN: { EUR: 0.23, USD: 0.25, GBP: 0.20 },
    EUR: { PLN: 4.35, USD: 1.08, GBP: 0.87 },
    USD: { PLN: 4.02, EUR: 0.93, GBP: 0.80 },
    GBP: { PLN: 5.03, EUR: 1.15, USD: 1.25 }
};

// Funkcja do pobierania aktualnych kurs√≥w
async function fetchExchangeRates() {
    try {
        showNotification('Pobieranie aktualnych kurs√≥w walut...', 'info');
        
        // U≈ºywamy darmowego API - exchangerate-api.com
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/PLN');
        const data = await response.json();
        
        if (data && data.rates) {
            // Aktualizuj kursy
            exchangeRates.PLN = {
                EUR: 1 / data.rates.EUR,
                USD: 1 / data.rates.USD,
                GBP: 1 / data.rates.GBP
            };
            
            // Pobierz kursy dla EUR jako bazy
            const eurResponse = await fetch('https://api.exchangerate-api.com/v4/latest/EUR');
            const eurData = await eurResponse.json();
            
            if (eurData && eurData.rates) {
                exchangeRates.EUR = {
                    PLN: eurData.rates.PLN,
                    USD: eurData.rates.USD,
                    GBP: eurData.rates.GBP
                };
            }
            
            // Pobierz kursy dla USD jako bazy
            const usdResponse = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
            const usdData = await usdResponse.json();
            
            if (usdData && usdData.rates) {
                exchangeRates.USD = {
                    PLN: usdData.rates.PLN,
                    EUR: usdData.rates.EUR,
                    GBP: usdData.rates.GBP
                };
            }
            
            // Pobierz kursy dla GBP jako bazy
            const gbpResponse = await fetch('https://api.exchangerate-api.com/v4/latest/GBP');
            const gbpData = await gbpResponse.json();
            
            if (gbpData && gbpData.rates) {
                exchangeRates.GBP = {
                    PLN: gbpData.rates.PLN,
                    EUR: gbpData.rates.EUR,
                    USD: gbpData.rates.USD
                };
            }
            
            // Zapisz datƒô ostatniej aktualizacji
            data.settings.lastRateUpdate = new Date().toISOString();
            saveData();
            
            showNotification('Kursy walut zosta≈Çy zaktualizowane!');
            console.log('üí± Kursy walut zaktualizowane:', exchangeRates);
        }
    } catch (error) {
        console.error('‚ùå B≈ÇƒÖd pobierania kurs√≥w:', error);
        showNotification('Nie uda≈Ço siƒô pobraƒá aktualnych kurs√≥w. U≈ºywam ostatnich zapisanych.', 'warning');
    }
}

// ========== INICJALIZACJA ==========
        document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ DOM za≈Çadowany, uruchamiam aplikacjƒô...');

    // Sprawd≈∫ zgodƒô RODO
    checkRodoConsent();
    
    // Sprawd≈∫ localStorage
    checkLocalStorageSupport();
    
    // Inicjalizuj nawigacjƒô zak≈Çadek - DODAJ TO!
    initializeNavigation();
    
    // Za≈Çaduj dane i od≈õwie≈º interfejs
    loadData();
    updateSummary();
    generateAIInsights();
    generateCalendar();
    updateCharts();
    
    // Pobierz aktualne kursy walut
    fetchExchangeRates();
    
    console.log('‚úÖ Aplikacja gotowa do u≈ºycia!');
});
        // ========== NAWIGACJA ZAK≈ÅADEK ==========
        function initializeNavigation() {
    console.log('üîß Inicjalizacja nawigacji...');

    const navTabs = document.querySelectorAll('.nav-tab');
    navTabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('data-tab');
            console.log('üìç Prze≈ÇƒÖczanie na zak≈Çadkƒô:', tabName);
            showTab(tabName);
        });
    });
}

        function showTab(tabName) {
            console.log('üîÑ Wy≈õwietlanie zak≈Çadki:', tabName);

            // Ukryj wszystkie zak≈Çadki
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Usu≈Ñ aktywnƒÖ klasƒô ze wszystkich przycisk√≥w
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Poka≈º wybranƒÖ zak≈Çadkƒô
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('‚úÖ Zak≈Çadka aktywna:', tabName);
            } else {
                console.error('‚ùå Nie znaleziono zak≈Çadki:', tabName);
            }

            // Aktywuj odpowiedni przycisk nawigacji
            const activeNavTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeNavTab) {
                activeNavTab.classList.add('active');
            }
        }

        // ========== ZARZƒÑDZANIE MOTYWAMI ==========
        function changeTheme(theme) {
            console.log('üé® Zmiana motywu na:', theme);

            document.body.setAttribute('data-theme', theme);
            data.settings.theme = theme;

            // Aktualizuj przyciski motyw√≥w
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.theme-${theme}`).classList.add('active');

            saveData();
            showNotification(`Motyw zmieniony na ${theme}!`);
        }

        function toggleDarkMode() {
            console.log('üåô Prze≈ÇƒÖczanie trybu ciemnego...');

            document.body.classList.toggle('dark-mode');
            data.settings.darkMode = document.body.classList.contains('dark-mode');

            saveData();
            showNotification(data.settings.darkMode ? 'Tryb ciemny w≈ÇƒÖczony' : 'Tryb ciemny wy≈ÇƒÖczony');
        }

        // ========== ZARZƒÑDZANIE DOCHODAMI ==========
        function addIncome() {
            console.log('üí∞ Dodawanie dochodu...');

            const source = document.getElementById('incomeSource').value.trim();
            const category = document.getElementById('incomeCategory').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const currency = document.getElementById('incomeCurrency').value;

            if (!source || !amount || amount <= 0) {
                showNotification('Proszƒô wype≈Çniƒá wszystkie pola poprawnie!', 'error');
                return;
            }

            const income = {
                id: Date.now(),
                source,
                category,
                amount,
                currency,
                date: new Date().toISOString()
            };

            data.incomes.push(income);
            console.log('‚úÖ Doch√≥d dodany:', income);

            updateIncomeList();
            updateSummary();
            generateAIInsights();
            clearIncomeForm();
            saveData();

            showNotification(`Doch√≥d "${source}" zosta≈Ç dodany!`);
        }

        function updateIncomeList() {
            const list = document.getElementById('incomeList');
            list.innerHTML = '';

            data.incomes.forEach(income => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${income.source}</td>
                    <td>${getCategoryEmoji(income.category)} ${getCategoryName(income.category)}</td>
                    <td>${formatCurrency(income.amount, income.currency)}</td>
                    <td>${income.currency}</td>
                    <td><button onclick="removeIncome(${income.id})">Usu≈Ñ</button></td>
                `;
                list.appendChild(row);
            });
        }

        function removeIncome(id) {
            const income = data.incomes.find(i => i.id === id);
            if (income && confirm(`Czy na pewno usunƒÖƒá doch√≥d "${income.source}"?`)) {
                data.incomes = data.incomes.filter(i => i.id !== id);
                updateIncomeList();
                updateSummary();
                generateAIInsights();
                saveData();
                showNotification('Doch√≥d zosta≈Ç usuniƒôty');
            }
        }

        function clearIncomeForm() {
            document.getElementById('incomeSource').value = '';
            document.getElementById('incomeAmount').value = '';
        }

        // ========== ZARZƒÑDZANIE WYDATKAMI ==========
        function addExpense() {
            console.log('üí∏ Dodawanie wydatku...');

            const name = document.getElementById('expenseName').value.trim();
            const category = document.getElementById('expenseCategory').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const currency = document.getElementById('expenseCurrency').value;

            if (!name || !amount || amount <= 0) {
                showNotification('Proszƒô wype≈Çniƒá wszystkie pola poprawnie!', 'error');
                return;
            }

            const expense = {
                id: Date.now(),
                name,
                category,
                amount,
                currency,
                date: new Date().toISOString()
            };

            data.expenses.push(expense);
            console.log('‚úÖ Wydatek dodany:', expense);

            updateExpenseList();
            updateSummary();
            generateAIInsights();
            clearExpenseForm();
            saveData();

            showNotification(`Wydatek "${name}" zosta≈Ç dodany!`);
        }

        function updateExpenseList() {
            const list = document.getElementById('expenseList');
            list.innerHTML = '';

            data.expenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${expense.name}</td>
                    <td>${getCategoryEmoji(expense.category)} ${getCategoryName(expense.category)}</td>
                    <td>${formatCurrency(expense.amount, expense.currency)}</td>
                    <td>${expense.currency}</td>
                    <td><button onclick="removeExpense(${expense.id})">Usu≈Ñ</button></td>
                `;
                list.appendChild(row);
            });
        }

        function removeExpense(id) {
            const expense = data.expenses.find(e => e.id === id);
            if (expense && confirm(`Czy na pewno usunƒÖƒá wydatek "${expense.name}"?`)) {
                data.expenses = data.expenses.filter(e => e.id !== id);
                updateExpenseList();
                updateSummary();
                generateAIInsights();
                saveData();
                showNotification('Wydatek zosta≈Ç usuniƒôty');
            }
        }

        function clearExpenseForm() {
            document.getElementById('expenseName').value = '';
            document.getElementById('expenseAmount').value = '';
        }

        // ========== ZARZƒÑDZANIE OSZCZƒòDNO≈öCIAMI ==========
        function addSaving() {
            console.log('üê∑ Dodawanie planu oszczƒôdno≈õci...');

            const goal = document.getElementById('savingGoal').value.trim();
            const amount = parseFloat(document.getElementById('savingAmount').value);
            const priority = document.getElementById('savingPriority').value;

            if (!goal || !amount || amount <= 0) {
                showNotification('Proszƒô wype≈Çniƒá wszystkie pola poprawnie!', 'error');
                return;
            }

            const saving = {
                id: Date.now(),
                goal,
                amount,
                priority,
                date: new Date().toISOString()
            };

            data.savings.push(saving);
            console.log('‚úÖ Plan oszczƒôdno≈õci dodany:', saving);

            updateSavingsList();
            updateSummary();
            clearSavingForm();
            saveData();

            showNotification(`Plan oszczƒôdno≈õci "${goal}" zosta≈Ç dodany!`);
        }

        function updateSavingsList() {
            const list = document.getElementById('savingsList');
            list.innerHTML = '';

            if (data.savings.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Brak plan√≥w oszczƒôdno≈õci</p>';
                return;
            }

            data.savings.forEach(saving => {
                const priorityIcon = saving.priority === 'high' ? 'üî¥' : (saving.priority === 'medium' ? 'üü°' : 'üü¢');

                const card = document.createElement('div');
                card.className = 'goal-card';
                card.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">${priorityIcon} ${saving.goal}</div>
                        <div class="goal-amount">${formatCurrency(saving.amount, 'PLN')}/miesiƒÖc</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-danger btn-small" onclick="removeSaving(${saving.id})">Usu≈Ñ</button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function removeSaving(id) {
            const saving = data.savings.find(s => s.id === id);
            if (saving && confirm(`Czy na pewno usunƒÖƒá plan oszczƒôdno≈õci "${saving.goal}"?`)) {
                data.savings = data.savings.filter(s => s.id !== id);
                updateSavingsList();
                updateSummary();
                saveData();
                showNotification('Plan oszczƒôdno≈õci zosta≈Ç usuniƒôty');
            }
        }

        function clearSavingForm() {
            document.getElementById('savingGoal').value = '';
            document.getElementById('savingAmount').value = '';
        }

        // ========== ZARZƒÑDZANIE CELAMI ==========
        function addGoal() {
            console.log('üéØ Dodawanie celu...');

            const name = document.getElementById('goalName').value.trim();
            const target = parseFloat(document.getElementById('goalTarget').value);
            const deadline = document.getElementById('goalDeadline').value;

            if (!name || !target || target <= 0 || !deadline) {
                showNotification('Proszƒô wype≈Çniƒá wszystkie pola poprawnie!', 'error');
                return;
            }

            const goal = {
                id: Date.now(),
                name,
                target,
                current: 0,
                deadline,
                date: new Date().toISOString()
            };

            data.goals.push(goal);
            console.log('‚úÖ Cel dodany:', goal);

            updateGoalsList();
            clearGoalForm();
            saveData();

            showNotification(`Cel "${name}" zosta≈Ç dodany!`);
        }

        function updateGoalsList() {
            const list = document.getElementById('goalsList');
            list.innerHTML = '';

            if (data.goals.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Brak cel√≥w finansowych</p>';
                return;
            }

            data.goals.forEach(goal => {
                const progress = (goal.current / goal.target) * 100;
                const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));

                const card = document.createElement('div');
                card.className = 'goal-card';
                card.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">${goal.name}</div>
                        <div class="goal-amount">${formatCurrency(goal.current, 'PLN')} / ${formatCurrency(goal.target, 'PLN')}</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(progress, 100)}%">
                            <div class="progress-text">${progress.toFixed(1)}%</div>
                        </div>
                    </div>
                    <p style="margin: 10px 0;">Pozosta≈Ço dni: ${daysLeft > 0 ? daysLeft : 'Termin minƒÖ≈Ç'}</p>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="number" placeholder="Dodaj kwotƒô" id="goalAdd${goal.id}" step="0.01" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <button class="btn btn-small" onclick="addToGoal(${goal.id})">Dodaj</button>
                        <button class="btn btn-danger btn-small" onclick="removeGoal(${goal.id})">Usu≈Ñ</button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function addToGoal(id) {
            const input = document.getElementById(`goalAdd${id}`);
            const amount = parseFloat(input.value);

            if (!amount || amount <= 0) {
                showNotification('Podaj poprawnƒÖ kwotƒô!', 'error');
                return;
            }

            const goal = data.goals.find(g => g.id === id);
            if (goal) {
                goal.current += amount;
                input.value = '';
                updateGoalsList();
                saveData();
                showNotification(`Dodano ${formatCurrency(amount, 'PLN')} do celu "${goal.name}"`);
            }
        }

        function removeGoal(id) {
            const goal = data.goals.find(g => g.id === id);
            if (goal && confirm(`Czy na pewno usunƒÖƒá cel "${goal.name}"?`)) {
                data.goals = data.goals.filter(g => g.id !== id);
                updateGoalsList();
                saveData();
                showNotification('Cel zosta≈Ç usuniƒôty');
            }
        }

        function clearGoalForm() {
            document.getElementById('goalName').value = '';
            document.getElementById('goalTarget').value = '';
            document.getElementById('goalDeadline').value = '';
        }

        // ========== KALENDARZ P≈ÅATNO≈öCI ==========
        function addPayment() {
            console.log('üìÖ Dodawanie p≈Çatno≈õci...');

            const name = document.getElementById('paymentName').value.trim();
            const date = document.getElementById('paymentDate').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const recurring = document.getElementById('paymentRecurring').value;

            if (!name || !date || !amount || amount <= 0) {
                showNotification('Proszƒô wype≈Çniƒá wszystkie pola poprawnie!', 'error');
                return;
            }

            const payment = {
                id: Date.now(),
                name,
                date,
                amount,
                recurring
            };

            data.payments.push(payment);
            console.log('‚úÖ P≈Çatno≈õƒá dodana:', payment);

            generateCalendar();
            updatePaymentList();
            clearPaymentForm();
            saveData();

            showNotification(`P≈Çatno≈õƒá "${name}" zosta≈Ça dodana do kalendarza!`);
        }

        function updatePaymentList() {
            const list = document.getElementById('paymentList');
            list.innerHTML = '';

            if (data.payments.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align: center; color: #666;">Brak p≈Çatno≈õci w kalendarzu</td>';
                list.appendChild(row);
                return;
            }

            data.payments.forEach(payment => {
                const row = document.createElement('tr');
                const recurringText = getRecurringText(payment.recurring);

                row.innerHTML = `
                    <td>${payment.name}</td>
                    <td>${new Date(payment.date).toLocaleDateString('pl-PL')}</td>
                    <td>${formatCurrency(payment.amount, 'PLN')}</td>
                    <td>${recurringText}</td>
                    <td><button onclick="removePayment(${payment.id})">Usu≈Ñ</button></td>
                `;
                list.appendChild(row);
            });
        }

        function removePayment(id) {
            const payment = data.payments.find(p => p.id === id);
            if (payment && confirm(`Czy na pewno usunƒÖƒá p≈Çatno≈õƒá "${payment.name}"?`)) {
                data.payments = data.payments.filter(p => p.id !== id);
                generateCalendar();
                updatePaymentList();
                saveData();
                showNotification('P≈Çatno≈õƒá zosta≈Ça usuniƒôta z kalendarza');
            }
        }

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            generateCalendar();
        }

        function generateCalendar() {
            const calendar = document.getElementById('calendarGrid');
            const monthYearDisplay = document.getElementById('currentMonthYear');

            if (!calendar || !monthYearDisplay) return;

            calendar.innerHTML = '';

            // Aktualizuj wy≈õwietlanie miesiƒÖca/roku
            monthYearDisplay.textContent = currentCalendarDate.toLocaleDateString('pl-PL', { 
                month: 'long', 
                year: 'numeric' 
            });

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);

            // Nag≈Ç√≥wki dni tygodnia - PIERWSZA LINIA
            const dayHeaders = ['Poniedzia≈Çek', 'Wtorek', '≈öroda', 'Czwartek', 'PiƒÖtek', 'Sobota', 'Niedziela'];
            const dayAbbrevs = ['Pon', 'Wt', '≈ör', 'Czw', 'Pt', 'Sob', 'Nie'];

            dayAbbrevs.forEach((day, index) => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day header';
                dayElement.textContent = day;
                dayElement.title = dayHeaders[index];
                calendar.appendChild(dayElement);
            });

            // Znajd≈∫ pierwszy dzie≈Ñ do wy≈õwietlenia (poniedzia≈Çek przed pierwszym dniem miesiƒÖca)
            const startDate = new Date(firstDay);
            const dayOfWeek = firstDay.getDay();
            const daysBack = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Poniedzia≈Çek jako pierwszy dzie≈Ñ
            startDate.setDate(firstDay.getDate() - daysBack);

            // Generuj dok≈Çadnie 6 wierszy po 7 dni (42 dni total) - standardowy format kalendarza
            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day day-cell';

                const isCurrentMonth = currentDate.getMonth() === month;
                const isToday = currentDate.toDateString() === new Date().toDateString();

                // Dodaj klasy CSS
                if (!isCurrentMonth) {
                    dayElement.classList.add('other-month');
                }
                if (isToday) {
                    dayElement.classList.add('today');
                }

                // Numer dnia
                const dayNumber = document.createElement('div');
                dayNumber.className = 'calendar-day-number';
                dayNumber.textContent = currentDate.getDate();
                dayElement.appendChild(dayNumber);

                // Sprawd≈∫ p≈Çatno≈õci na ten dzie≈Ñ
                const dayPayments = [];

                data.payments.forEach(payment => {
                    const paymentDate = new Date(payment.date);
                    let shouldShow = false;

                    if (payment.recurring === 'none') {
                        shouldShow = paymentDate.toDateString() === currentDate.toDateString();
                    } else if (payment.recurring === 'monthly') {
                        shouldShow = paymentDate.getDate() === currentDate.getDate() && currentDate >= paymentDate;
                    } else if (payment.recurring === 'weekly') {
                        const daysDiff = Math.floor((currentDate - paymentDate) / (1000 * 60 * 60 * 24));
                        shouldShow = daysDiff >= 0 && daysDiff % 7 === 0;
                    } else if (payment.recurring === 'yearly') {
                        shouldShow = paymentDate.getDate() === currentDate.getDate() && 
                                   paymentDate.getMonth() === currentDate.getMonth() &&
                                   currentDate.getFullYear() >= paymentDate.getFullYear();
                    }

                    if (shouldShow) {
                        dayPayments.push(payment);
                    }
                });

                // Wy≈õwietl p≈Çatno≈õci jako listƒô
                if (dayPayments.length > 0) {
                    dayElement.classList.add('has-payment');

                    const paymentList = document.createElement('div');
                    paymentList.className = 'payment-list';

                    // Poka≈º maksymalnie 3 p≈Çatno≈õci (≈ºeby zmie≈õciƒá siƒô w kom√≥rce)
                    const maxPayments = 3;
                    const paymentsToShow = dayPayments.slice(0, maxPayments);

                    paymentsToShow.forEach(payment => {
                        const paymentItem = document.createElement('div');
                        paymentItem.className = `payment-item ${payment.recurring !== 'none' ? 'recurring' : ''}`;

                        // Skr√≥ƒá nazwƒô p≈Çatno≈õci je≈õli jest za d≈Çuga
                        let displayName = payment.name;
                        if (displayName.length > 10) {
                            displayName = displayName.substring(0, 10) + '...';
                        }

                        paymentItem.textContent = displayName;
                        paymentItem.title = `${payment.name}: ${formatCurrency(payment.amount, 'PLN')} (${getRecurringText(payment.recurring)})`;
                        paymentList.appendChild(paymentItem);
                    });

                    // Je≈õli wiƒôcej p≈Çatno≈õci, poka≈º liczbƒô pozosta≈Çych
                    if (dayPayments.length > maxPayments) {
                        const moreItem = document.createElement('div');
                        moreItem.className = 'payment-more';
                        moreItem.textContent = `+${dayPayments.length - maxPayments}`;
                        paymentList.appendChild(moreItem);
                    }

                    dayElement.appendChild(paymentList);

                    // Tooltip ze wszystkimi p≈Çatno≈õciami
                    const tooltipText = dayPayments.map(p => 
                        `${p.name}: ${formatCurrency(p.amount, 'PLN')} (${getRecurringText(p.recurring)})`
                    ).join('\n');
                    dayElement.title = tooltipText;
                }

                // Click handler dla dodania nowej p≈Çatno≈õci
                dayElement.addEventListener('click', function() {
                    if (isCurrentMonth) {
                        const dateString = currentDate.toISOString().split('T')[0];
                        document.getElementById('paymentDate').value = dateString;
                        document.getElementById('paymentName').focus();
                        showNotification(`Data ustawiona na: ${currentDate.toLocaleDateString('pl-PL')}`);
                    }
                });

                calendar.appendChild(dayElement);
            }
        }

        function getRecurringText(recurring) {
            const texts = {
                none: 'jednorazowa',
                weekly: 'co tydzie≈Ñ',
                monthly: 'co miesiƒÖc',
                yearly: 'co rok'
            };
            return texts[recurring] || 'jednorazowa';
        }

        function clearPaymentForm() {
            document.getElementById('paymentName').value = '';
            document.getElementById('paymentDate').value = '';
            document.getElementById('paymentAmount').value = '';
            document.getElementById('paymentRecurring').value = 'none';
        }

        // ========== ZARZƒÑDZANIE D≈ÅUGAMI ==========
        function addDebt() {
            console.log('üí≥ Dodawanie d≈Çugu...');

            const name = document.getElementById('debtName').value.trim();
            const amount = parseFloat(document.getElementById('debtAmount').value);
            const installment = parseFloat(document.getElementById('debtInstallment').value);
            const interest = parseFloat(document.getElementById('debtInterest').value);

            if (!name) {
                showNotification('Proszƒô podaƒá nazwƒô d≈Çugu!', 'error');
                return;
            }

            if (!amount || amount <= 0) {
                showNotification('Proszƒô podaƒá poprawnƒÖ kwotƒô d≈Çugu!', 'error');
                return;
            }

            const debt = {
                id: Date.now(),
                name: name,
                amount: amount,
                installment: installment || 0,
                interest: interest || 0,
                originalAmount: amount,
                date: new Date().toISOString()
            };

            data.debts.push(debt);
            console.log('‚úÖ D≈Çug dodany:', debt);

            updateDebtsList();
            updateSummary();
            generateAIInsights();
            clearDebtForm();
            saveData();

            showNotification(`D≈Çug "${name}" zosta≈Ç dodany!`);
        }

        function updateDebtsList() {
            console.log('üîÑ Aktualizacja listy d≈Çug√≥w...');

            const list = document.getElementById('debtsList');
            list.innerHTML = '';

            if (data.debts.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>üìù Brak d≈Çug√≥w</h3>
                        <p>Dodaj sw√≥j pierwszy d≈Çug u≈ºywajƒÖc formularza powy≈ºej</p>
                    </div>
                `;
                return;
            }

            data.debts.forEach(debt => {
                const monthsToPayOff = debt.installment > 0 ? Math.ceil(debt.amount / debt.installment) : 'Nieokre≈õlony';
                const totalInterestCost = debt.installment > 0 && monthsToPayOff !== 'Nieokre≈õlony' ? 
                    (debt.installment * monthsToPayOff) - debt.amount : 0;
                const progressPercent = debt.originalAmount > 0 ? 
                    ((debt.originalAmount - debt.amount) / debt.originalAmount * 100) : 0;

                const card = document.createElement('div');
                card.className = 'debt-card';
                card.innerHTML = `
                    <div class="debt-header">
                        <div class="debt-title">üí≥ ${debt.name}</div>
                        <div class="debt-amount">${formatCurrency(debt.amount, 'PLN')}</div>
                    </div>

                    <div style="margin: 15px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <strong>üí∞ Rata miesiƒôczna:</strong><br>
                                ${debt.installment > 0 ? formatCurrency(debt.installment, 'PLN') : 'Nie ustalona'}
                            </div>
                            <div>
                                <strong>üìà Oprocentowanie:</strong><br>
                                ${debt.interest}% rocznie
                            </div>
                        </div>

                        ${debt.installment > 0 ? `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <strong>‚è±Ô∏è Czas sp≈Çaty:</strong><br>
                                    ${monthsToPayOff} miesiƒôcy
                                </div>
                                <div>
                                    <strong>üí∏ ≈ÅƒÖczne odsetki:</strong><br>
                                    ${formatCurrency(totalInterestCost, 'PLN')}
                                </div>
                            </div>
                        ` : ''}

                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span><strong>Postƒôp sp≈Çaty</strong></span>
                                <span><strong>${progressPercent.toFixed(1)}%</strong></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%">
                                    <div class="progress-text">${progressPercent.toFixed(1)}% sp≈Çacone</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <input type="number" 
                               placeholder="Kwota sp≈Çaty" 
                               id="paymentAmount${debt.id}" 
                               step="0.01" 
                               style="flex: 1; padding: 10px; border: 2px solid var(--accent-color); border-radius: 8px;">
                        <button class="btn btn-success btn-small" onclick="makePayment(${debt.id})">
                            üí∞ Sp≈Çaƒá
                        </button>
                        <button class="btn btn-danger btn-small" onclick="removeDebt(${debt.id})">
                            üóëÔ∏è Usu≈Ñ
                        </button>
                    </div>
                `;

                list.appendChild(card);
            });

            console.log('‚úÖ Lista d≈Çug√≥w zaktualizowana');
        }

        function makePayment(debtId) {
            console.log('üí∞ Sp≈Çata d≈Çugu:', debtId);

            const paymentInput = document.getElementById(`paymentAmount${debtId}`);
            const paymentAmount = parseFloat(paymentInput.value);

            if (!paymentAmount || paymentAmount <= 0) {
                showNotification('Podaj poprawnƒÖ kwotƒô sp≈Çaty!', 'error');
                return;
            }

            const debt = data.debts.find(d => d.id === debtId);
            if (!debt) {
                showNotification('Nie znaleziono d≈Çugu!', 'error');
                return;
            }

            if (paymentAmount > debt.amount) {
                showNotification('Kwota sp≈Çaty nie mo≈ºe byƒá wiƒôksza ni≈º pozosta≈Çy d≈Çug!', 'error');
                return;
            }

            debt.amount -= paymentAmount;
            paymentInput.value = '';

            if (debt.amount <= 0) {
                // D≈Çug w pe≈Çni sp≈Çacony
                data.debts = data.debts.filter(d => d.id !== debtId);
                showNotification(`üéâ Gratulacje! D≈Çug "${debt.name}" zosta≈Ç w pe≈Çni sp≈Çacony!`);
            } else {
                showNotification(`Sp≈Çacono ${formatCurrency(paymentAmount, 'PLN')} z d≈Çugu "${debt.name}"`);
            }

            updateDebtsList();
            updateSummary();
            generateAIInsights();
            saveData();
        }

        function sortDebtsByInterest() {
            console.log('üìà Sortowanie d≈Çug√≥w wed≈Çug oprocentowania...');
            data.debts.sort((a, b) => b.interest - a.interest);
            updateDebtsList();
            saveData();
            showNotification('D≈Çugi posortowane wed≈Çug oprocentowania (najwy≈ºsze pierwsze)');
        }

        function sortDebtsByAmount() {
            console.log('üí∞ Sortowanie d≈Çug√≥w wed≈Çug kwoty...');
            data.debts.sort((a, b) => a.amount - b.amount);
            updateDebtsList();
            saveData();
            showNotification('D≈Çugi posortowane wed≈Çug kwoty (najmniejsze pierwsze)');
        }

        function removeDebt(id) {
            const debt = data.debts.find(d => d.id === id);
            if (debt && confirm(`Czy na pewno usunƒÖƒá d≈Çug "${debt.name}"?`)) {
                data.debts = data.debts.filter(d => d.id !== id);
                updateDebtsList();
                updateSummary();
                generateAIInsights();
                saveData();
                showNotification('D≈Çug zosta≈Ç usuniƒôty');
            }
        }

        function clearDebtForm() {
            document.getElementById('debtName').value = '';
            document.getElementById('debtAmount').value = '';
            document.getElementById('debtInstallment').value = '';
            document.getElementById('debtInterest').value = '';
        }
        // ========== WYKRESY I ANALIZY ==========
        function updateCharts() {
            console.log('üìä Aktualizacja wykres√≥w...');
            setTimeout(() => {
                updateExpenseChart();
                updateTrendChart();
                updateComparisonChart();
                updateGoalsChart();
                updateDebtsChart();
            }, 100);
        }

        function updateExpenseChart() {
            const ctx = document.getElementById('expenseChart');
            if (!ctx) return;

            // Wyczy≈õƒá poprzedni wykres
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            const categories = {};
            data.expenses.forEach(expense => {
                const category = getCategoryName(expense.category);
                const amount = convertToPLN(expense.amount, expense.currency);
                categories[category] = (categories[category] || 0) + amount;
            });

            const labels = Object.keys(categories);
            const values = Object.values(categories);

            if (labels.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                const context = ctx.getContext('2d');
                context.fillStyle = '#666';
                context.font = '16px Arial';
                context.textAlign = 'center';
                context.fillText('Brak danych do wy≈õwietlenia', ctx.width/2, ctx.height/2);
                return;
            }

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#e91e63', '#2196f3', '#4caf50', '#ff9800', 
                            '#9c27b0', '#f44336', '#00bcd4', '#795548',
                            '#ffc107', '#607d8b', '#e4c441', '#8bc34a'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.parsed, 'PLN');
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;

            // Wyczy≈õƒá poprzedni wykres
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            // Generuj dane z ostatnich 6 miesiƒôcy
            const months = [];
            const incomeData = [];
            const expenseData = [];

            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                months.push(date.toLocaleDateString('pl-PL', { month: 'short', year: 'numeric' }));

                const monthIncome = data.incomes
                    .filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate.getMonth() === date.getMonth() && 
                               itemDate.getFullYear() === date.getFullYear();
                    })
                    .reduce((sum, item) => sum + convertToPLN(item.amount, item.currency), 0);

                const monthExpense = data.expenses
                    .filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate.getMonth() === date.getMonth() && 
                               itemDate.getFullYear() === date.getFullYear();
                    })
                    .reduce((sum, item) => sum + convertToPLN(item.amount, item.currency), 0);

                incomeData.push(monthIncome);
                expenseData.push(monthExpense);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Dochody',
                        data: incomeData,
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Wydatki',
                        data: expenseData,
                        borderColor: '#f44336',
                        backgroundColor: 'rgba(244, 67, 54, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.parsed.y, 'PLN')}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value, 'PLN');
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function updateComparisonChart() {
            const ctx = document.getElementById('comparisonChart');
            if (!ctx) return;

            // Wyczy≈õƒá poprzedni wykres
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            const totalIncome = calculateTotal(data.incomes);
            const totalExpenses = calculateTotal(data.expenses);
            const totalSavings = calculateTotal(data.savings);
            const balance = totalIncome - totalExpenses;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Dochody', 'Wydatki', 'Oszczƒôdno≈õci', 'Saldo'],
                    datasets: [{
                        label: 'Kwota (PLN)',
                        data: [totalIncome, totalExpenses, totalSavings, balance],
                        backgroundColor: [
                            '#4caf50', 
                            '#f44336', 
                            '#2196f3', 
                            balance >= 0 ? '#4caf50' : '#f44336'
                        ],
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${formatCurrency(context.parsed.y, 'PLN')}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value, 'PLN');
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateGoalsChart() {
            const ctx = document.getElementById('goalsChart');
            if (!ctx) return;

            // Wyczy≈õƒá poprzedni wykres
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            if (data.goals.length === 0) {
                const context = ctx.getContext('2d');
                context.clearRect(0, 0, ctx.width, ctx.height);
                context.fillStyle = '#666';
                context.font = '16px Arial';
                context.textAlign = 'center';
                context.fillText('Brak cel√≥w finansowych', ctx.width/2, ctx.height/2);
                return;
            }

            const labels = data.goals.map(goal => goal.name);
            const progressData = data.goals.map(goal => (goal.current / goal.target) * 100);
            const remainingData = data.goals.map(goal => Math.max(0, 100 - (goal.current / goal.target) * 100));

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'OsiƒÖgniƒôte (%)',
                        data: progressData,
                        backgroundColor: '#4caf50',
                        borderRadius: 4,
                    }, {
                        label: 'Pozosta≈Ço (%)',
                        data: remainingData,
                        backgroundColor: '#e0e0e0',
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const goalIndex = context.dataIndex;
                                    const goal = data.goals[goalIndex];
                                    if (context.datasetIndex === 0) {
                                        return `OsiƒÖgniƒôte: ${formatCurrency(goal.current, 'PLN')} (${context.parsed.y.toFixed(1)}%)`;
                                    } else {
                                        const remaining = goal.target - goal.current;
                                        return `Pozosta≈Ço: ${formatCurrency(remaining, 'PLN')} (${context.parsed.y.toFixed(1)}%)`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateDebtsChart() {
            const ctx = document.getElementById('debtsChart');
            if (!ctx) return;

            // Wyczy≈õƒá poprzedni wykres
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            if (data.debts.length === 0) {
                const context = ctx.getContext('2d');
                context.clearRect(0, 0, ctx.width, ctx.height);
                context.fillStyle = '#666';
                context.font = '16px Arial';
                context.textAlign = 'center';
                context.fillText('Brak d≈Çug√≥w do sp≈Çaty', ctx.width/2, ctx.height/2);
                return;
            }

            const labels = data.debts.map(debt => debt.name);
            const amounts = data.debts.map(debt => debt.amount);
            const interests = data.debts.map(debt => debt.interest);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Kwota d≈Çugu (PLN)',
                        data: amounts,
                        backgroundColor: '#f44336',
                        borderRadius: 4,
                        yAxisID: 'y'
                    }, {
                        label: 'Oprocentowanie (%)',
                        data: interests,
                        backgroundColor: '#ff9800',
                        borderRadius: 4,
                        type: 'line',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Kwota: ${formatCurrency(context.parsed.y, 'PLN')}`;
                                    } else {
                                        return `Oprocentowanie: ${context.parsed.y}%`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value, 'PLN');
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // ========== PRZELICZNIK WALUT ==========
        function convertCurrency() {
            console.log('üí± Przeliczanie walut...');

            const amount = parseFloat(document.getElementById('convertAmount').value);
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;

            if (!amount || amount <= 0) {
                showNotification('Podaj poprawnƒÖ kwotƒô!', 'error');
                return;
            }

            let result = amount;
            if (from !== to) {
                if (exchangeRates[from] && exchangeRates[from][to]) {
                    result = amount * exchangeRates[from][to];
                } else {
                    showNotification('Brak kursu dla wybranej pary walut!', 'error');
                    return;
                }
            }

            const resultDiv = document.getElementById('conversionResult');
            resultDiv.innerHTML = `
                <h4>Wynik przeliczenia:</h4>
                <p style="font-size: 1.2em; font-weight: bold; color: var(--primary-color);">
                    ${formatCurrency(amount, from)} = ${formatCurrency(result, to)}
                </p>
            `;
            resultDiv.style.display = 'block';

            showNotification('Waluta przeliczona!');
        }

        // ========== OBLICZENIA PODSUMOWANIA ==========
        function updateSummary() {
            console.log('üìä Aktualizacja podsumowania...');

            const totalIncome = calculateTotal(data.incomes);
            const totalExpenses = calculateTotal(data.expenses);
            const totalSavings = calculateTotal(data.savings);
            const totalDebts = calculateTotalDebts();
            const balance = totalIncome - totalExpenses;
            const available = balance - totalSavings;

            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome, 'PLN');
            document.getElementById('totalExpenses').textContent = formatCurrency(totalExpenses, 'PLN');
            document.getElementById('totalSavings').textContent = formatCurrency(totalSavings, 'PLN');
            document.getElementById('totalDebts').textContent = formatCurrency(totalDebts, 'PLN');

            const balanceElement = document.getElementById('balance');
            balanceElement.textContent = formatCurrency(balance, 'PLN');
            balanceElement.className = `amount ${balance >= 0 ? 'positive' : 'negative'}`;

            const availableElement = document.getElementById('available');
            availableElement.textContent = formatCurrency(available, 'PLN');
            availableElement.className = `amount ${available >= 0 ? 'positive' : 'negative'}`;

            console.log('‚úÖ Podsumowanie zaktualizowane');
        }

        function calculateTotal(items) {
            return items.reduce((total, item) => {
                const amount = convertToPLN(item.amount, item.currency || 'PLN');
                return total + amount;
            }, 0);
        }

        function calculateTotalDebts() {
            return data.debts.reduce((total, debt) => {
                // U≈ºywamy raty miesiƒôcznej do obliczenia miesiƒôcznego obciƒÖ≈ºenia
                const amount = convertToPLN(debt.installment || 0, 'PLN');
                return total + amount;
            }, 0);
        }

        function convertToPLN(amount, currency) {
            if (currency === 'PLN') return amount;
            if (exchangeRates[currency] && exchangeRates[currency]['PLN']) {
                return amount * exchangeRates[currency]['PLN'];
            }
            return amount;
        }

        // ========== ANALIZY AI ==========
        function generateAIInsights() {
            console.log('ü§ñ Generowanie analiz AI...');

            const insights = [];
            const totalIncome = calculateTotal(data.incomes);
            const totalExpenses = calculateTotal(data.expenses);
            const totalSavings = calculateTotal(data.savings);
            const balance = totalIncome - totalExpenses;

            // Analiza dochod√≥w vs wydatk√≥w
            if (totalIncome > 0 && totalExpenses > totalIncome * 0.9) {
                insights.push({
                    icon: '‚ö†Ô∏è',
                    title: 'Uwaga na wydatki!',
                    message: `Twoje wydatki stanowiƒÖ ${((totalExpenses/totalIncome)*100).toFixed(1)}% dochod√≥w. Rozwa≈º ograniczenie niekt√≥rych koszt√≥w.`
                });
            }

            // Analiza stopy oszczƒôdno≈õci
            if (totalIncome > 0) {
                const savingsRate = totalSavings / totalIncome;
                if (savingsRate < 0.1) {
                    insights.push({
                        icon: 'üê∑',
                        title: 'Zwiƒôksz oszczƒôdno≈õci',
                        message: `Obecnie oszczƒôdzasz ${(savingsRate * 100).toFixed(1)}% dochod√≥w. Eksperci zalecajƒÖ minimum 10%.`
                    });
                } else if (savingsRate >= 0.2) {
                    insights.push({
                        icon: 'üéâ',
                        title: '≈öwietne oszczƒôdzanie!',
                        message: `Oszczƒôdzasz ${(savingsRate * 100).toFixed(1)}% swoich dochod√≥w. To doskona≈Çy wynik!`
                    });
                }
            }

            // Analiza d≈Çug√≥w
            if (data.debts.length > 0) {
                const totalDebtAmount = data.debts.reduce((sum, debt) => sum + debt.amount, 0);
                const monthlyDebtPayments = data.debts.reduce((sum, debt) => sum + (debt.installment || 0), 0);

                if (totalIncome > 0 && monthlyDebtPayments > totalIncome * 0.3) {
                    insights.push({
                        icon: 'üí≥',
                        title: 'Wysokie obciƒÖ≈ºenie d≈Çugami',
                        message: `Miesiƒôczne raty d≈Çug√≥w stanowiƒÖ ${((monthlyDebtPayments / totalIncome) * 100).toFixed(1)}% dochod√≥w. Zalecane jest maksymalnie 30%.`
                    });
                } else if (data.debts.length > 3) {
                    insights.push({
                        icon: 'üí≥',
                        title: 'Konsolidacja d≈Çug√≥w',
                        message: `Masz ${data.debts.length} r√≥≈ºnych d≈Çug√≥w. Rozwa≈º ich konsolidacjƒô dla lepszego zarzƒÖdzania.`
                    });
                } else if (data.debts.length > 0) {
                    const highestInterestDebt = data.debts.reduce((max, debt) => debt.interest > max.interest ? debt : max, data.debts[0]);
                    if (highestInterestDebt.interest > 10) {
                        insights.push({
                            icon: 'üí≥',
                            title: 'Priorytet sp≈Çaty',
                            message: `D≈Çug "${highestInterestDebt.name}" ma najwy≈ºsze oprocentowanie (${highestInterestDebt.interest}%). Skoncentruj siƒô na jego szybszej sp≈Çacie.`
                        });
                    }
                }
            }

            // Analiza cel√≥w
            if (data.goals.length > 0) {
                const achievableGoals = data.goals.filter(goal => {
                    const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                    const remaining = goal.target - goal.current;
                    return daysLeft > 0 && remaining > 0;
                });

                if (achievableGoals.length > 0) {
                    insights.push({
                        icon: 'üéØ',
                        title: 'Cele finansowe',
                        message: `Masz ${achievableGoals.length} aktywnych cel√≥w finansowych. Regularne oszczƒôdzanie pomo≈ºe Ci je osiƒÖgnƒÖƒá!`
                    });
                }
            }

            // Domy≈õlna wiadomo≈õƒá je≈õli brak danych
            if (insights.length === 0) {
                insights.push({
                    icon: 'üìà',
                    title: 'Rozpocznij swojƒÖ przygodƒô finansowƒÖ',
                    message: 'Dodaj wiƒôcej danych o swoich dochodach i wydatkach, aby otrzymaƒá szczeg√≥≈Çowe analizy i rekomendacje.'
                });
            }

            // Aktualizuj wy≈õwietlanie analiz
            const insightsList = document.getElementById('aiInsightsList');
            insightsList.innerHTML = '';

            insights.forEach(insight => {
                const item = document.createElement('div');
                item.className = 'insight-item';
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.3em;">${insight.icon}</span>
                        <div>
                            <strong>${insight.title}:</strong> 
                            <span>${insight.message}</span>
                        </div>
                    </div>
                `;
                insightsList.appendChild(item);
            });

            console.log('‚úÖ Analizy AI wygenerowane');
        }

        // ========== RAPORTY ==========
        function generateReport(type) {
            console.log(`üìã Generowanie raportu: ${type}`);

            const reportContent = document.getElementById('reportContent');
            let html = '';

            switch (type) {
                case 'monthly':
                    html = generateMonthlyReport();
                    break;
                case 'yearly':
                    html = generateYearlyReport();
                    break;
                case 'category':
                    html = generateCategoryReport();
                    break;
                default:
                    html = '<p>Nieznany typ raportu</p>';
            }

            reportContent.innerHTML = html;
            showNotification(`Raport ${type} zosta≈Ç wygenerowany!`);
        }

        function generateMonthlyReport() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const monthlyIncomes = data.incomes.filter(item => {
                const date = new Date(item.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            const monthlyExpenses = data.expenses.filter(item => {
                const date = new Date(item.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            const totalIncome = monthlyIncomes.reduce((sum, item) => sum + convertToPLN(item.amount, item.currency), 0);
            const totalExpenses = monthlyExpenses.reduce((sum, item) => sum + convertToPLN(item.amount, item.currency), 0);

            return `
                <div class="section" style="margin-top: 20px;">
                    <h3>üìÖ Raport Miesiƒôczny - ${now.toLocaleDateString('pl-PL', { month: 'long', year: 'numeric' })}</h3>
                    <div class="two-column">
                        <div>
                            <h4>üí∞ Podsumowanie finansowe</h4>
                            <p><strong>Dochody:</strong> ${formatCurrency(totalIncome, 'PLN')}</p>
                            <p><strong>Wydatki:</strong> ${formatCurrency(totalExpenses, 'PLN')}</p>
                            <p><strong>Saldo:</strong> <span class="${totalIncome - totalExpenses >= 0 ? 'positive' : 'negative'}">${formatCurrency(totalIncome - totalExpenses, 'PLN')}</span></p>
                        </div>
                        <div>
                            <h4>üìä Statystyki</h4>
                            <p><strong>Liczba dochod√≥w:</strong> ${monthlyIncomes.length}</p>
                            <p><strong>Liczba wydatk√≥w:</strong> ${monthlyExpenses.length}</p>
                            <p><strong>≈öredni wydatek:</strong> ${monthlyExpenses.length > 0 ? formatCurrency(totalExpenses / monthlyExpenses.length, 'PLN') : '0,00 z≈Ç'}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateYearlyReport() {
            const currentYear = new Date().getFullYear();

            const yearlyIncomes = data.incomes.filter(item => new Date(item.date).getFullYear() === currentYear);
            const yearlyExpenses = data.expenses.filter(item => new Date(item.date).getFullYear() === currentYear);

            const totalIncome = yearlyIncomes.reduce((sum, item) => sum + convertToPLN(item.amount, item.currency), 0);
            const totalExpenses = yearlyExpenses.reduce((sum, item) => sum + convertToPLN(item.amount, item.currency), 0);

            return `
                <div class="section" style="margin-top: 20px;">
                    <h3>üìÖ Raport Roczny - ${currentYear}</h3>
                    <div class="two-column">
                        <div>
                            <h4>üí∞ Podsumowanie roczne</h4>
                            <p><strong>≈ÅƒÖczne dochody:</strong> ${formatCurrency(totalIncome, 'PLN')}</p>
                            <p><strong>≈ÅƒÖczne wydatki:</strong> ${formatCurrency(totalExpenses, 'PLN')}</p>
                            <p><strong>Roczne saldo:</strong> <span class="${totalIncome - totalExpenses >= 0 ? 'positive' : 'negative'}">${formatCurrency(totalIncome - totalExpenses, 'PLN')}</span></p>
                            <p><strong>≈örednio miesiƒôcznie:</strong> ${formatCurrency((totalIncome - totalExpenses) / 12, 'PLN')}</p>
                        </div>
                        <div>
                            <h4>üìà Statystyki</h4>
                            <p><strong>Transakcji w roku:</strong> ${yearlyIncomes.length + yearlyExpenses.length}</p>
                            <p><strong>Aktywnych cel√≥w:</strong> ${data.goals.length}</p>
                            <p><strong>Plan√≥w oszczƒôdno≈õci:</strong> ${data.savings.length}</p>
                            <p><strong>D≈Çug√≥w w sp≈Çacie:</strong> ${data.debts.length}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCategoryReport() {
            const categories = {};

            data.expenses.forEach(expense => {
                const category = getCategoryName(expense.category);
                const amount = convertToPLN(expense.amount, expense.currency);
                if (!categories[category]) {
                    categories[category] = { amount: 0, count: 0 };
                }
                categories[category].amount += amount;
                categories[category].count += 1;
            });

            const sortedCategories = Object.entries(categories).sort((a, b) => b[1].amount - a[1].amount);
            const totalExpenses = Object.values(categories).reduce((sum, cat) => sum + cat.amount, 0);

            if (sortedCategories.length === 0) {
                return `
                    <div class="section" style="margin-top: 20px;">
                        <h3>üìä Raport Kategorii</h3>
                        <p>Brak wydatk√≥w do analizy. Dodaj wydatki, aby zobaczyƒá raport kategorii.</p>
                    </div>
                `;
            }

            let categoryHtml = `
                <div class="section" style="margin-top: 20px;">
                    <h3>üìä Raport Kategorii</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Kategoria</th>
                                <th>Kwota</th>
                                <th>Procent</th>
                                <th>Liczba</th>
                                <th>≈örednia</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedCategories.forEach(([category, data]) => {
                const percentage = ((data.amount / totalExpenses) * 100).toFixed(1);
                const average = data.amount / data.count;
                categoryHtml += `
                    <tr>
                        <td>${category}</td>
                        <td>${formatCurrency(data.amount, 'PLN')}</td>
                        <td>${percentage}%</td>
                        <td>${data.count}</td>
                        <td>${formatCurrency(average, 'PLN')}</td>
                    </tr>
                `;
            });

            categoryHtml += '</tbody></table></div>';
            return categoryHtml;
        }

        // ========== FUNKCJE POMOCNICZE ==========
        function getCategoryName(category) {
            const names = {
                salary: 'Pensja',
                freelance: 'Freelance',
                business: 'Biznes',
                investment: 'Inwestycje',
                housing: 'Mieszkanie',
                food: 'Jedzenie',
                transport: 'Transport',
                health: 'Zdrowie',
                entertainment: 'Rozrywka',
                shopping: 'Zakupy',
                education: 'Edukacja',
                utilities: 'Media',
                other: 'Inne'
            };
            return names[category] || 'Inne';
        }

        function getCategoryEmoji(category) {
            const emojis = {
                salary: 'üíº',
                freelance: 'üíª',
                business: 'üè¢',
                investment: 'üìà',
                housing: 'üè†',
                food: 'üçΩÔ∏è',
                transport: 'üöó',
                health: '‚öïÔ∏è',
                entertainment: 'üé¨',
                shopping: 'üõçÔ∏è',
                education: 'üìö',
                utilities: '‚ö°',
                other: 'üîÑ'
            };
            return emojis[category] || 'üîÑ';
        }

        function formatCurrency(amount, currency = 'PLN') {
            const symbols = { PLN: 'z≈Ç', EUR: '‚Ç¨', USD: '$', GBP: '¬£' };
            return `${amount.toFixed(2)} ${symbols[currency]}`;
        }

        function showNotification(message, type = 'success') {
            if (!data.settings.notifications) return;

            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ========== ZARZƒÑDZANIE DANYMI ==========
        // Sprawd≈∫ dostƒôpno≈õƒá localStorage
        function checkLocalStorageSupport() {
            try {
                const test = 'localStorageTest';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);

                const statusElement = document.getElementById('storageStatus');
                if (statusElement) statusElement.textContent = 'Dane zapisywane lokalnie ‚úÖ';
                return true;
            } catch (error) {
                console.warn('‚ö†Ô∏è localStorage nie jest dostƒôpne:', error);
                showNotification('Uwaga: Dane nie bƒôdƒÖ zapisywane miƒôdzy sesjami', 'warning');

                const statusElement = document.getElementById('storageStatus');
                if (statusElement) statusElement.textContent = 'Tylko sesja bie≈ºƒÖca ‚ö†Ô∏è';
                return false;
            }
        }

        // Automatyczna kopia zapasowa
        function autoBackupToFile() {
            if (!data.settings.autoBackup) return;

            try {
                const now = new Date();
                const dateString = now.toISOString().split('T')[0];
                const timeString = now.toTimeString().split(' ')[0].replace(/:/g, '-');

                const dataString = JSON.stringify(data, null, 2);
                const blob = new Blob([dataString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `auto_backup_${dateString}_${timeString}.json`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('üì¶ Automatyczna kopia zapasowa utworzona');
            } catch (error) {
                console.error('‚ùå B≈ÇƒÖd automatycznej kopii:', error);
            }
        }

        function saveData() {
            try {
                localStorage.setItem('budgetAppData', JSON.stringify(data));
                console.log('üíæ Dane zapisane w localStorage');

                if (data.settings.autoBackup) {
                    autoBackupToFile();
                }
            } catch (error) {
                console.error('‚ùå B≈ÇƒÖd zapisywania:', error);
                showNotification('B≈ÇƒÖd podczas zapisywania danych', 'error');
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('budgetAppData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);

                    // Scal z domy≈õlnymi ustawieniami
                    data = {
                        incomes: parsedData.incomes || [],
                        expenses: parsedData.expenses || [],
                        savings: parsedData.savings || [],
                        goals: parsedData.goals || [],
                        payments: parsedData.payments || [],
                        debts: parsedData.debts || [],
                        settings: {
                            defaultCurrency: 'PLN',
                            autoBackup: false,
                            notifications: true,
                            theme: 'pink',
                            darkMode: false,
                            autoRateUpdate: false,
                            lastRateUpdate: null,
                            ...parsedData.settings,
                        }
                    };

                    console.log('üìÇ Dane wczytane z localStorage');
                } else {
                    console.log('üìÇ Brak zapisanych danych, u≈ºywam domy≈õlnych');
                }

                updateIncomeList();
                updateExpenseList();
                updateSavingsList();
                updateGoalsList();
                updateDebtsList();
                updatePaymentList();
                generateCalendar();
                updateLastRateInfo();

                // Zastosuj zapisane ustawienia
                if (data.settings.theme) {
                    changeTheme(data.settings.theme);
                }
                if (data.settings.darkMode) {
                    document.body.classList.add('dark-mode');
                }

                // Ustaw checkboxy w ustawieniach
                setTimeout(() => {
                    const autoBackupCheckbox = document.getElementById('autoBackup');
                    if (autoBackupCheckbox) autoBackupCheckbox.checked = data.settings.autoBackup;

                    const notificationsCheckbox = document.getElementById('notifications');
                    if (notificationsCheckbox) notificationsCheckbox.checked = data.settings.notifications;

                    const defaultCurrencySelect = document.getElementById('defaultCurrency');
                    if (defaultCurrencySelect) defaultCurrencySelect.value = data.settings.defaultCurrency;

                    const autoRateUpdateCheckbox = document.getElementById('autoRateUpdate');
                    if (autoRateUpdateCheckbox) autoRateUpdateCheckbox.checked = data.settings.autoRateUpdate;
                }, 100);
// Aktualizuj sekcjƒô RODO w ustawieniach
                const rodoSection = document.getElementById('rodoSettingsSection');
                if (rodoSection) {
                    rodoSection.innerHTML = showRodoSettings();
                }
            } catch (error) {
                console.error('‚ùå B≈ÇƒÖd wczytywania:', error);
                showNotification('B≈ÇƒÖd podczas wczytywania danych', 'error');
            }
        }

        function exportData() {
            try {
                const dataString = JSON.stringify(data, null, 2);
                const blob = new Blob([dataString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `budzet_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showNotification('Dane zosta≈Çy wyeksportowane!');
            } catch (error) {
                showNotification('B≈ÇƒÖd podczas eksportu danych', 'error');
            }
        }

        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // Scal zaimportowane dane
                    if (importedData.incomes) data.incomes = importedData.incomes;
                    if (importedData.expenses) data.expenses = importedData.expenses;
                    if (importedData.savings) data.savings = importedData.savings;
                    if (importedData.goals) data.goals = importedData.goals;
                    if (importedData.payments) data.payments = importedData.payments;
                    if (importedData.debts) data.debts = importedData.debts;
                    if (importedData.settings) data.settings = { ...data.settings, ...importedData.settings };

                    // Od≈õwie≈º interfejs
                    loadData();
                    updateSummary();
                    generateAIInsights();
                    updateCharts();
                    saveData();

                    showNotification('Dane zosta≈Çy zaimportowane pomy≈õlnie!');
                } catch (error) {
                    showNotification('B≈ÇƒÖd podczas importu danych. Sprawd≈∫ format pliku.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Czy na pewno chcesz usunƒÖƒá wszystkie dane? Ta operacja jest nieodwracalna.')) {
                // Wyczy≈õƒá localStorage
                localStorage.removeItem('budgetAppData');

                // Zresetuj dane w pamiƒôci
                data = {
                    incomes: [],
                    expenses: [],
                    savings: [],
                    goals: [],
                    payments: [],
                    debts: [],
                    settings: {
                        defaultCurrency: 'PLN',
                        autoBackup: false,
                        notifications: true,
                        theme: 'pink',
                        darkMode: false,
                        autoRateUpdate: false,
                        lastRateUpdate: null
                    }
                };

                loadData();
                updateSummary();
                generateAIInsights();
                updateCharts();
                showNotification('Wszystkie dane zosta≈Çy usuniƒôte (r√≥wnie≈º z localStorage)');
            }
        }

        // ========== USTAWIENIA ==========
        function updateDefaultCurrency() {
            const currency = document.getElementById('defaultCurrency').value;
            data.settings.defaultCurrency = currency;
            saveData();
            showNotification(`Domy≈õlna waluta zmieniona na ${currency}`);
        }

        function toggleAutoBackup() {
            data.settings.autoBackup = document.getElementById('autoBackup').checked;
            saveData();
            showNotification(`Automatyczne kopie zapasowe ${data.settings.autoBackup ? 'w≈ÇƒÖczone' : 'wy≈ÇƒÖczone'}`);
        }

        function toggleNotifications() {
            data.settings.notifications = document.getElementById('notifications').checked;
            saveData();
            if (data.settings.notifications) {
                showNotification('Powiadomienia zosta≈Çy w≈ÇƒÖczone');
            }
        }

        console.log('‚úÖ Wszystkie funkcje za≈Çadowane pomy≈õlnie!');
// Funkcja do wy≈õwietlania informacji o ostatniej aktualizacji
        function updateLastRateInfo() {
    const infoElement = document.getElementById('lastUpdateInfo');
    if (infoElement && data.settings.lastRateUpdate) {
        const lastUpdate = new Date(data.settings.lastRateUpdate);
        infoElement.textContent = `Kursy z: ${lastUpdate.toLocaleDateString('pl-PL')} ${lastUpdate.toLocaleTimeString('pl-PL')}`;
    }
}

        // Automatyczna aktualizacja kurs√≥w co godzinƒô
        setInterval(() => {
            if (data.settings.autoRateUpdate) {
                fetchExchangeRates();
            }
        }, 60 * 60 * 1000); // 1 godzina
// ========== ZARZƒÑDZANIE RODO ==========
        function checkRodoConsent() {
            const consent = localStorage.getItem('rodoConsent');
            if (!consent) {
                setTimeout(() => {
                    document.getElementById('rodoBanner').classList.add('show');
                }, 1000);
            }
            return consent === 'accepted';
        }

        function acceptRodo() {
    localStorage.setItem('rodoConsent', 'accepted');
    localStorage.setItem('rodoConsentDate', new Date().toISOString());
    document.getElementById('rodoBanner').classList.remove('show');
    document.getElementById('rodoDetails').classList.remove('show');
    showNotification('‚úÖ Zgoda RODO zosta≈Ça udzielona');
    
    // W≈ÇƒÖcz pe≈ÇnƒÖ funkcjonalno≈õƒá
    data.settings.rodoAccepted = true;
    saveData();
}

        function rejectRodo() {
    localStorage.setItem('rodoConsent', 'rejected');
    document.getElementById('rodoBanner').classList.remove('show');
    
    // Wyczy≈õƒá wszystkie dane
    localStorage.clear();
    
    // Zablokuj zapisywanie
    data.settings.rodoAccepted = false;
    
    showNotification('‚ùå Zgoda RODO zosta≈Ça odrzucona. Aplikacja bƒôdzie dzia≈Çaƒá w trybie tylko do odczytu.', 'warning');
    
    // Wy≈ÇƒÖcz funkcje zapisywania
    disableSaveFeatures();
}

        function showRodoDetails() {
            document.getElementById('rodoDetails').classList.add('show');
        }

        function closeRodoDetails() {
            document.getElementById('rodoDetails').classList.remove('show');
        }

        function disableSaveFeatures() {
    // Wy≈ÇƒÖcz wszystkie przyciski dodawania
    const addButtons = document.querySelectorAll('button[onclick*="add"]');
    addButtons.forEach(btn => {
        btn.disabled = true;
        btn.title = 'Funkcja wy≈ÇƒÖczona - brak zgody RODO';
    });
    
    // Dodaj informacjƒô
    const info = document.createElement('div');
    info.innerHTML = `
        <div style="background: #ffeb3b; color: #333; padding: 15px; margin: 20px; border-radius: 10px; text-align: center;">
            <strong>‚ö†Ô∏è Tryb tylko do odczytu</strong><br>
            Aby w pe≈Çni korzystaƒá z aplikacji, zaakceptuj warunki RODO.
            <button class="btn" onclick="location.reload()">üîÑ Od≈õwie≈º stronƒô</button>
        </div>
    `;
    document.querySelector('.container').insertBefore(info, document.querySelector('.summary-cards'));
}

        function showRodoSettings() {
    const consent = localStorage.getItem('rodoConsent');
    const consentDate = localStorage.getItem('rodoConsentDate');
    
    let status = 'Nie udzielono zgody';
    let statusClass = 'negative';
    
    if (consent === 'accepted') {
        status = `Zgoda udzielona: ${new Date(consentDate).toLocaleDateString('pl-PL')}`;
        statusClass = 'positive';
    } else if (consent === 'rejected') {
        status = 'Zgoda odrzucona';
        statusClass = 'negative';
    }
    
    return `
        <div class="rodo-section">
            <h4>üìã Status RODO</h4>
            <p class="${statusClass}"><strong>${status}</strong></p>
            <div style="margin-top: 10px;">
                <button class="btn btn-small" onclick="showRodoDetails()">üìÑ Poka≈º szczeg√≥≈Çy</button>
                <button class="btn btn-small btn-warning" onclick="revokeRodoConsent()">‚ùå Cofnij zgodƒô</button>
            </div>
        </div>
    `;
}

        function revokeRodoConsent() {
            if (confirm('Czy na pewno chcesz cofnƒÖƒá zgodƒô RODO? Wszystkie dane zostanƒÖ usuniƒôte.')) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>